<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>444Music Admin Panel</title>
<link rel="stylesheet" href="admin.css">
</head>

<body>

<h2>444Music Admin Panel</h2>

<input type="text" id="search" placeholder="Search artist name...">

<div id="results"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBzUD7avh7vJfeSMRl2o9F09_qd-pl0dSg",
  authDomain: "usersubmissionsportal.firebaseapp.com",
  projectId: "usersubmissionsportal",
  storageBucket: "usersubmissionsportal.firebasestorage.app",
  messagingSenderId: "734783502459",
  appId: "1:734783502459:web:cfa2cc5de6976003b24ade"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const results = document.getElementById("results");
const search = document.getElementById("search");

let submissions = [];

async function loadSubmissions(){
  const querySnapshot = await getDocs(collection(db,"submissions"));

  submissions = [];

  querySnapshot.forEach((docSnap)=>{
    submissions.push({
      id: docSnap.id,
      ...docSnap.data()
    });
  });

  display(submissions);
}

function display(data){
  results.innerHTML="";

  data.forEach(item=>{
    const div = document.createElement("div");
    div.className="card";

    div.innerHTML = `
      <b>${item.artistName || "Unknown Artist"}</b><br>
      Song: ${item.songTitle || "Untitled"}<br>
      Status: ${item.status || "Pending"}<br>

      <select onchange="changeStatus('${item.id}', this.value)">
        <option value="">Change Status</option>
        <option value="Pending">Pending</option>
        <option value="In-Review">In-Review</option>
        <option value="Approved">Approved</option>
        <option value="Removed">Removed</option>
      </select>
    `;

    results.appendChild(div);
  });
}

search.addEventListener("input",()=>{
  const value = search.value.toLowerCase();

  const filtered = submissions.filter(item =>
    (item.artistName || "").toLowerCase().includes(value)
  );

  display(filtered);
});

window.changeStatus = async function(id, status){
  if(!status) return;

  await updateDoc(doc(db,"submissions",id),{
    status: status
  });

  loadSubmissions();
}

loadSubmissions();
</script>

</body>
</html>
